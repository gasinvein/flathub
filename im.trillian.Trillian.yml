id: im.trillian.Trillian
runtime: org.freedesktop.Platform
sdk: org.freedesktop.Sdk
runtime-version: '20.08'
finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  - --device=dri
  - --socket=pulseaudio
  - --share=network
  - --own-name=gtk.Trillian
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.gtk.Notifications
  - --talk-name=org.kde.StatusNotifierWatcher
  - --talk-name=org.gnome.SessionManager
  - --filesystem=xdg-download
  - --persist=.trillian
command: trillian
cleanup:
  - '*.a'
  - '*.la'
  - /include
  - /lib/*/include
  - /lib/*/proc
  - /lib/pkgconfig
  - /share/aclocal
  - /share/doc
  - /share/devhelp
  - /share/man
modules:

  - name: gtkmm
    buildsystem: meson
    sources:
      - type: archive
        url: https://download.gnome.org/sources/gtkmm/3.24/gtkmm-3.24.4.tar.xz
        sha256: 9beb71c3e90cfcfb790396b51e3f5e7169966751efd4f3ef9697114be3be6743
        x-checker-data:
          type: gnome
          name: gtkmm
          versions:
            <: '4.0'
    modules:

      - name: libsigc
        buildsystem: meson
        sources:
          - type: archive
            url: https://download.gnome.org/sources/libsigc++/2.10/libsigc++-2.10.6.tar.xz
            sha256: dda176dc4681bda9d5a2ac1bc55273bdd381662b7a6d49e918267d13e8774e1b
            x-checker-data:
              type: gnome
              name: libsigc++
              versions:
                <: '3.0'

      - name: glibmm
        buildsystem: meson
        sources:
          - type: archive
            url: https://download.gnome.org/sources/glibmm/2.66/glibmm-2.66.0.tar.xz
            sha256: 9e1db7d43d2e2d4dfa2771354e21a69a6beec7c446b711619cf8c779e13a581e
            x-checker-data:
              type: gnome
              name: glibmm
              versions:
                <: '2.67'

      - name: cairomm
        sources:
          - type: archive
            url: https://download.gnome.org/sources/cairomm/1.12/cairomm-1.12.0.tar.xz
            sha256: a54ada8394a86182525c0762e6f50db6b9212a2109280d13ec6a0b29bfd1afe6
            x-checker-data:
              type: gnome
              name: cairomm

      - name: pangomm
        buildsystem: meson
        sources:
          - type: archive
            url: https://download.gnome.org/sources/pangomm/2.46/pangomm-2.46.0.tar.xz
            sha256: d3787d04d6198b606f3efa357b3b452a7140e2a7dee56f9f9ce516d7d5fcec1b
            x-checker-data:
              type: gnome
              name: pangomm
              versions:
                <: '2.47'

      - name: atkmm
        buildsystem: meson
        sources:
          - type: archive
            url: https://download.gnome.org/sources/atkmm/2.28/atkmm-2.28.1.tar.xz
            sha256: 116876604770641a450e39c1f50302884848ce9cc48d43c5dc8e8efc31f31bad
            x-checker-data:
              type: gnome
              name: atkmm
              versions:
                <: '2.29'

  - name: libnotify
    buildsystem: meson
    config-opts:
      - -Dtests=false
      - -Dman=false
      - -Dgtk_doc=false
      - -Ddocbook_docs=disabled
    sources:
      - type: archive
        url: https://download.gnome.org/sources/libnotify/0.7/libnotify-0.7.9.tar.xz
        sha256: 66c0517ed16df7af258e83208faaf5069727dfd66995c4bbc51c16954d674761
        x-checker-data:
          type: gnome
          name: libnotify
          stable-only: false
    modules:

      - name: gnome-common
        cleanup:
          - '*'
        sources:
          - type: archive
            url: https://download.gnome.org/sources/gnome-common/3.18/gnome-common-3.18.0.tar.xz
            sha256: 22569e370ae755e04527b76328befc4c73b62bfd4a572499fde116b8318af8cf
            x-checker-data:
              type: gnome
              name: gnome-common

  - shared-modules/dbus-glib/dbus-glib-0.110.json

  - shared-modules/libappindicator/libappindicator-gtk3-introspection-12.10.json

  - shared-modules/libsecret/libsecret.json

  - name: trillian
    buildsystem: simple
    build-commands:
      - mkdir -p /app/bin /app/lib
      - cp /usr/bin/ar /app/bin
      - cp /usr/lib/$(gcc -print-multiarch)/libbfd-*.so /app/lib
      - install -Dm755 apply_extra /app/bin/apply_extra
      - ln -sf ../extra/trillian/trillian /app/bin/trillian
    sources:
      - type: script
        dest-filename: apply_extra
        commands:
          - ar x trillian.deb
          - tar -xf data.tar.xz
          - mv usr/share/trillian trillian
          - install -Dm644 usr/share/applications/trillian.desktop export/share/applications/im.trillian.Trillian.desktop
          - install -Dm644 usr/share/icons/hicolor/scalable/apps/trillian.svg export/share/icons/hicolor/scalable/apps/im.trillian.Trillian.png
          - sed 's|Exec=.*|Exec=trillian|g' -i export/share/applications/im.trillian.Trillian.desktop
          - sed 's|Icon=.*|Icon=im.trillian.Trillian|g' -i export/share/applications/im.trillian.Trillian.desktop
          - rm -r usr trillian.deb data.tar.xz control.tar.gz debian-binary
      - type: extra-data
        only-arches:
          - x86_64
        url: https://trillian.im/get/linux/6.3/trillian_6.3.0.1_amd64.deb
        filename: trillian.deb
        size: 14153966
        sha256: 42e3466ee236ac2644907059f0961eba3a6ed6b6156afb2c57f54ebe6065ac6f
        x-checker-data:
          type: html
          url: https://www.trillian.im/get/linux
          pattern: (/get/linux/([\.\d-]+)/\?deb=64)
          follow-redirects: true
          is-main-source: true
