{
    "app-id": "io.itch.itch",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "1.6",
    "sdk": "org.freedesktop.Sdk",
    "sdk-extensions" : [
        "org.freedesktop.Sdk.Extension.golang"
    ],
    "base": "io.atom.electron.BaseApp",
    "base-version": "stable",
    "branch": "stable",
    "command": "itch",
    "rename-icon": "itch",
    "rename-appdata-file": "itch.appdata.xml",
    "finish-args": [
        "--share=ipc",
        "--socket=x11",
        "--device=all",
        "--socket=pulseaudio",
        "--share=network",
        "--allow=multiarch",
        "--talk-name=org.gnome.GConf",
        "--talk-name=org.gtk.Notifications",
        "--talk-name=org.freedesktop.Notifications",
        "--talk-name=org.kde.StatusNotifierWatcher",
        "--talk-name=org.gtk.vfs",
        "--talk-name=org.gtk.vfs.*",
        "--env=ELECTRON_TRASH=gio",
        "--extension=org.freedesktop.Platform.Compat32=directory=lib/32bit",
        "--extension=org.freedesktop.Platform.Compat32=version=1.6",
        "--extension=org.freedesktop.Platform.GL32=directory=lib/32bit/lib/GL",
        "--extension=org.freedesktop.Platform.GL32=version=1.4",
        "--extension=org.freedesktop.Platform.GL32=versions=1.6;1.4",
        "--extension=org.freedesktop.Platform.GL32=subdirectories=true",
        "--extension=org.freedesktop.Platform.GL32=no-autodownload=true",
        "--extension=org.freedesktop.Platform.GL32=autodelete=false",
        "--extension=org.freedesktop.Platform.GL32=add-ld-path=lib",
        "--extension=org.freedesktop.Platform.GL32=merge-dirs=vulkan/icd.d;glvnd/egl_vendor.d",
        "--extension=org.freedesktop.Platform.GL32=download-if=active-gl-driver",
        "--extension=org.freedesktop.Platform.GL32=enable-if=active-gl-driver",
        "--persist=."
    ],
    "modules": [
        {
            "name": "butler",
            "buildsystem": "simple",
            "build-options": {
                "env": {
                    "GOPATH": "/run/build/butler"
                }
            },
            "build-commands" : [
                ". /usr/lib/sdk/golang/enable.sh; go build github.com/itchio/butler",
                "install -Dm0755 butler -t /app/bin/"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/itchio/butler/archive/v13.1.0.tar.gz",
                    "sha256": "db3d12731076f2bbbcc0be6d992ebc5339c407ddb3222baf49b29132de356599",
                    "dest" : "src/github.com/itchio/butler"
                },
                {
                    "type": "git",
                    "url": "https://github.com/itchio/spellbook",
                    "commit": "98649825c402139ef1b75792f9b42d0e92d4c26e",
                    "dest": "src/github.com/itchio/spellbook"
                },
                {
                    "type": "git",
                    "url": "https://github.com/itchio/wizardry",
                    "commit": "8b25a114f7971ae6a0d56b6d43827693a192f7a0",
                    "dest": "src/github.com/itchio/wizardry"
                },
                {
                    "type": "git",
                    "url": "https://github.com/jgallagher/gosaca",
                    "commit": "754749770f0849e02d70651a75d4f9d5c5a62a6f",
                    "dest": "src/github.com/jgallagher/gosaca"
                },
                {
                    "type": "git",
                    "url": "https://github.com/olekukonko/tablewriter",
                    "commit": "d4647c9c7a84d847478d890b816b7d8b62b0b279",
                    "dest": "src/github.com/olekukonko/tablewriter"
                },
                {
                    "type": "git",
                    "url": "https://github.com/Datadog/zstd",
                    "commit": "aebefd9fcb99f22cd691ef778a12ed68f0e6a1ab",
                    "dest": "src/github.com/Datadog/zstd"
                },
                {
                    "type": "git",
                    "url": "https://github.com/kardianos/osext",
                    "dest": "src/github.com/kardianos/osext"
                },
                {
                    "type": "git",
                    "url": "https://github.com/mattn/go-runewidth",
                    "dest": "src/github.com/mattn/go-runewidth"
                },
                {
                    "type": "git",
                    "url": "https://github.com/golang/crypto",
                    "dest": "src/golang.org/x/crypto"
                },
                {
                    "type": "git",
                    "url": "https://github.com/golang/text",
                    "dest": "src/golang.org/x/text"
                },
                {
                    "type": "git",
                    "url": "https://github.com/golang/sys",
                    "dest": "src/golang.org/x/sys"
                }
            ]
        },
        {
            "name": "itch",
            "buildsystem": "simple",
            "build-commands": [
                "ar x itch.deb",
                "tar -xf data.tar.xz --transform='flags=r;s|usr/||' -C /app",
                "rmdir /app/usr",
                "rm itch.deb data.tar.xz control.tar.gz debian-binary"
            ],
            "post-install": [
                "sed 's/itch.desktop/io.itch.itch.desktop/' -i /app/share/metainfo/itch.appdata.xml"
            ],
            "sources": [
                {
                    "type": "file",
                    "only-arches": [ "i386" ],
                    "dest-filename": "itch.deb",
                    "url": "https://dl.bintray.com/itchio/deb/itch_23.6.3_i386.deb",
                    "sha256": "ee31ad51d2aee275f1f9087bea601389821b5b89168952a6c068f937c3522aec"
                },
                {
                    "type": "file",
                    "only-arches": [ "x86_64" ],
                    "dest-filename": "itch.deb",
                    "url": "https://dl.bintray.com/itchio/deb/itch_23.6.3_amd64.deb",
                    "sha256": "53c47f7c21261850c44f37c5fcc055eda3f67bbf79bc596292f48d3b5f31e8e9"
                },
                {
                    "type": "file",
                    "path": "ld.so.conf"
                }
            ],
            "post-install": [
                "mkdir -p /app/lib/32bit",
                "ln -s /app/lib/32bit/lib/ld-linux.so.2 /app/lib/ld-linux.so.2",
                "install -Dm644 ld.so.conf /app/etc/ld.so.conf"
            ]
        }
    ]
}
