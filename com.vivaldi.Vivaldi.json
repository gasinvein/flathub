{
    "app-id": "com.vivaldi.Vivaldi",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "1.6",
    "base": "io.atom.electron.BaseApp",
    "base-version": "stable",
    "branch": "stable",
    "sdk": "org.freedesktop.Sdk",
    "command": "vivaldi",
    "rename-desktop-file": "vivaldi-stable.desktop",
    "rename-appdata-file": "vivaldi.appdata.xml",
    "rename-icon": "vivaldi",
    "finish-args": [
        "--socket=x11", "--share=ipc",
        "--device=dri",
        "--share=network",
        "--talk-name=org.gnome.GConf",
        "--talk-name=org.freedesktop.Notifications",
        "--talk-name=org.gtk.Notifications",
        "--talk-name=org.kde.StatusNotifierWatcher",
        "--talk-name=org.freedesktop.secrets",
        "--talk-name=org.gnome.SessionManager",
        "--system-talk-name=org.freedesktop.UPower",
        "--system-talk-name=org.freedesktop.NetworkManager"
    ],
    "modules": [
        {
            "name": "gyp",
            "buildsystem": "simple",
            "cleanup": [ "*" ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://chromium.googlesource.com/external/gyp",
                    "commit": "324dd166b7c0b39d513026fa52d6280ac6d56770"
                }
            ],
            "build-commands": [
                "python2 setup.py install --prefix=/app"
            ]
        },
        {
            "name": "nss",
            "buildsystem": "simple",
            "subdir": "nss",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://ftp.mozilla.org/pub/security/nss/releases/NSS_3_32_RTM/src/nss-3.32.tar.gz",
                    "sha256": "35c6f381cc96bb25e4f924469f6ba3e57b3a16e0c2fb7e295a284a00d57ed335"
                }
            ],
            "build-commands": [
                "./build.sh --system-sqlite --system-nspr --enable-libpkix -v -o",
                "install -D ../dist/Release/lib/*.so /app/lib"
            ]
        },
        {
            "name": "vivaldi",
            "buildsystem": "simple",
            "build-commands": [
                "ar x vivaldi-*.deb",
                "tar xf data.tar.xz",
                "mkdir -p /app/{bin,lib,share}",
                "cp -ax opt/vivaldi /app/lib/",
                "cp -ax usr/share/* /app/share/",
                "for s in 16 22 24 32 48 64 128 256; do install -Dm644 opt/vivaldi/product_logo_$s.png /app/share/icons/hicolor/${s}x${s}/apps/vivaldi.png; done",
                "sed 's/Exec=.*/Exec=vivaldi %U/g' -i /app/share/applications/vivaldi*.desktop",
                "install -Dm755 vivaldi.sh /app/bin/vivaldi"
            ],
            "build-options": {
                "strip": false,
                "no-debuginfo": true
            },
            "sources": [
                {
                    "type": "file",
                    "url": "https://downloads.vivaldi.com/stable/vivaldi-stable_1.15.1147.36-1_amd64.deb",
                    "sha256": "6f8bc097a2bba17b8c3995d4474bdb7d0fd59fa438343134d68c299892c84932"
                },
                {
                    "type": "script",
                    "dest-filename": "vivaldi.sh",
                    "commands": [
                        "exec /app/lib/vivaldi/vivaldi --no-sandbox $@"
                    ]
                }
            ],
            "cleanup": [
                "/share/doc",
                "/share/xfce4",
                "/share/gnome-control-center"
            ]
        }
    ]
}
