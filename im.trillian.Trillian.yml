id: im.trillian.Trillian
runtime: org.freedesktop.Platform
sdk: org.freedesktop.Sdk
runtime-version: "20.08"
finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  - --device=dri
  - --socket=pulseaudio
  - --share=network
  - --own-name=gtk.Trillian
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.gtk.Notifications
  - --talk-name=org.kde.StatusNotifierWatcher
  - --talk-name=org.gnome.SessionManager
  - --filesystem=xdg-download
  - --persist=.trillian
command: trillian
cleanup:
  - '*.a'
  - '*.la'
  - /include
  - /lib/*/include
  - /lib/*/proc
  - /lib/pkgconfig
  - /share/aclocal
  - /share/doc
  - /share/devhelp
  - /share/man
modules:

  - name: gtkmm
    sources:
      - type: archive
        url: "https://download.gnome.org/sources/gtkmm/3.24/gtkmm-3.24.1.tar.xz"
        sha256: ddfe42ed2458a20a34de252854bcf4b52d3f0c671c045f56b42aa27c7542d2fd
    modules:

      - name: libsigc
        sources:
          - type: archive
            url: "https://download.gnome.org/sources/libsigc++/2.10/libsigc++-2.10.2.tar.xz"
            sha256: b1ca0253379596f9c19f070c83d362b12dfd39c0a3ea1dd813e8e21c1a097a98

      - name: glibmm
        sources:
          - type: archive
            url: "https://download.gnome.org/sources/glibmm/2.58/glibmm-2.58.1.tar.xz"
            sha256: 6e5fe03bdf1e220eeffd543e017fd2fb15bcec9235f0ffd50674aff9362a85f0

      - name: cairomm
        sources:
          - type: archive
            url: "https://download.gnome.org/sources/cairomm/1.12/cairomm-1.12.0.tar.xz"
            sha256: a54ada8394a86182525c0762e6f50db6b9212a2109280d13ec6a0b29bfd1afe6

      - name: pangomm
        sources:
          - type: archive
            url: "https://download.gnome.org/sources/pangomm/2.42/pangomm-2.42.0.tar.xz"
            sha256: ca6da067ff93a6445780c0b4b226eb84f484ab104b8391fb744a45cbc7edbf56

      - name: atkmm
        sources:
          - type: archive
            url: "https://download.gnome.org/sources/atkmm/2.28/atkmm-2.28.0.tar.xz"
            sha256: 4c4cfc917fd42d3879ce997b463428d6982affa0fb660cafcc0bc2d9afcedd3a

  - name: libnotify
    sources:
      - type: archive
        url: "https://download.gnome.org/sources/libnotify/0.7/libnotify-0.7.8.tar.xz"
        sha256: 69209e0b663776a00c7b6c0e560302a8dbf66b2551d55616304f240bba66e18c
    modules:

      - name: gnome-common
        cleanup:
          - "*"
        sources:
          - type: archive
            url: "https://download.gnome.org/sources/gnome-common/3.18/gnome-common-3.18.0.tar.xz"
            sha256: 22569e370ae755e04527b76328befc4c73b62bfd4a572499fde116b8318af8cf

  - shared-modules/dbus-glib/dbus-glib-0.110.json

  - shared-modules/libappindicator/libappindicator-gtk3-introspection-12.10.json

  - name: trillian
    buildsystem: simple
    build-commands:
      - mkdir -p /app/bin /app/lib
      - cp /usr/bin/ar /app/bin
      - cp /usr/lib/$(gcc -print-multiarch)/libbfd-*.so /app/lib
      - install -Dm755 apply_extra /app/bin/apply_extra
      - ln -sf ../extra/trillian/trillian /app/bin/trillian
    sources:
      - type: script
        dest-filename: apply_extra
        commands:
          - ar x trillian.deb
          - tar -xf data.tar.xz
          - mv usr/share/trillian trillian
          - install -Dm644 usr/share/applications/trillian.desktop export/share/applications/im.trillian.Trillian.desktop
          - install -Dm644 usr/share/icons/hicolor/scalable/apps/trillian.svg export/share/icons/hicolor/scalable/apps/im.trillian.Trillian.png
          - sed 's|Exec=.*|Exec=trillian|g' -i export/share/applications/im.trillian.Trillian.desktop
          - sed 's|Icon=.*|Icon=im.trillian.Trillian|g' -i export/share/applications/im.trillian.Trillian.desktop
          - rm -r usr trillian.deb data.tar.xz control.tar.gz debian-binary
      - type: extra-data
        only-arches:
          - x86_64
        url: https://www.trillian.im/get/linux/6.1/trillian_6.1.0.5_amd64.deb
        filename: trillian.deb
        size: 7471968
        sha256: 4758bf1a1dea06730dbc2c6952cad22ecd1a2ed722a030a2cd1e6584b9e97d42
