id: io.github.cmdrkotori.MpcQt
sdk: org.kde.Sdk
runtime: org.kde.Platform
runtime-version: "5.11"
command: mpc-qt
rename-icon: mpc-qt
rename-desktop-file: mpc-qt.desktop
rename-appdata-file: mpc-qt.appdata.xml
finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  - --device=all
  - --socket=pulseaudio
  - --share=network
  - --talk-name=org.mpris.MediaPlayer2.Player
  - --own-name=org.mpris.MediaPlayer2.MpcQt
  - --talk-name=org.freedesktop.ScreenSaver
cleanup:
  - "*.a"
  - "*.la"
  - /include
  - /lib/pkgconfig
  - /share/man
  - /share/doc
modules:
  - name: mpc-qt
    buildsystem: qmake
    sources:
      - type: git
        url: "https://github.com/cmdrkotori/mpc-qt.git"
        tag: v18.08
    modules:

      - name: libmpv
        config-opts:
          - --enable-libmpv-shared
          #- --disable-cplayer
          - --disable-build-date
          - --disable-oss-audio
          - --disable-alsa
          - --enable-tv
        sources:
          - type: archive
            url: "https://github.com/mpv-player/mpv/archive/v0.29.1.tar.gz"
            sha256: f9f9d461d1990f9728660b4ccb0e8cb5dce29ccaa6af567bec481b79291ca623
          - type: file
            url: "https://waf.io/waf-2.0.12"
            sha256: 0979ca87f45928e0d752049ab2f43be8551249be73dc5563b944ec54f8871d1f
            dest-filename: waf
          - type: script
            dest-filename: configure
            commands:
              - python3 waf configure $@
          - type: file
            path: waf-Makefile
            dest-filename: Makefile
        modules:

          - name: libv4l2
            config-opts:
              - --disable-static
              - --disable-bpf
            sources:
              - type: archive
                url: "https://linuxtv.org/downloads/v4l-utils/v4l-utils-1.16.2.tar.bz2"
                sha256: 6c3208c9a1c73455d30bae83096d161e57bec5008594f270a2a67df8c86d8e47
            modules:
              - shared-modules/udev/udev-175.json
              - shared-modules/glu/glu-9.0.0.json

          - name: ffmpeg
            config-opts:
              - --enable-shared
              - --disable-static
              - --enable-gnutls
              - --disable-doc
              - --disable-programs
              - --disable-encoders
              - --disable-muxers
              - --enable-encoder=png
              - --enable-libv4l2
            sources:
              - type: archive
                url: "https://ffmpeg.org/releases/ffmpeg-4.1.tar.xz"
                sha256: a38ec4d026efb58506a99ad5cd23d5a9793b4bf415f2c4c2e9c1bb444acd1994
            cleanup:
              - /share/ffmpeg/examples

          - name: luajit
            no-autogen: true
            make-install-args:
              - PREFIX=/app
            sources:
              - type: archive
                url: "http://luajit.org/download/LuaJIT-2.1.0-beta3.tar.gz"
                sha256: 1ad2e34b111c802f9d0cdf019e986909123237a28c746b21295b63c9e785d9c3
            cleanup:
              - /bin

          - name: libass
            config-opts:
              - --disable-static
            sources:
              - type: archive
                url: "https://github.com/libass/libass/releases/download/0.14.0/libass-0.14.0.tar.xz"
                sha256: 881f2382af48aead75b7a0e02e65d88c5ebd369fe46bc77d9270a94aa8fd38a2
            modules:

              - name: fribidi
                sources:
                  - type: archive
                    url: "https://github.com/fribidi/fribidi/releases/download/v1.0.5/fribidi-1.0.5.tar.bz2"
                    sha256: 6a64f2a687f5c4f203a46fa659f43dd43d1f8b845df8d723107e8a7e6158e4ce
                cleanup:
                  - /bin

          - name: uchardet
            buildsystem: cmake-ninja
            config-opts:
              - -DCMAKE_BUILD_TYPE=Release
              - -DBUILD_STATIC=0
            sources:
              - type: archive
                url: "https://www.freedesktop.org/software/uchardet/releases/uchardet-0.0.6.tar.xz"
                sha256: 8351328cdfbcb2432e63938721dd781eb8c11ebc56e3a89d0f84576b96002c61
            cleanup:
              - /bin
